<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ff6a00" />
  <title>Pelichet QC ‚Äì Contr√¥le Qualit√©</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icon-32.png" />
  <link rel="apple-touch-icon" href="icon-180.png" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
</head>

<body>
  <header>
    <img src="icon-180.png" alt="Pelichet" class="logo" />
    <h1>Pelichet QC</h1>
    <button id="themeToggle" title="Basculer clair/sombre">‚òÄÔ∏è/üåô</button>
  </header>

  <nav>
    <button class="tab active" data-target="tabCartons">Cartons</button>
    <button class="tab" data-target="tabPalettesAvant">Palettes Avant</button>
    <button class="tab" data-target="tabPalettesDestination">Palettes Destination</button>
    <button class="tab" data-target="tabKpi">KPI</button>
  </nav>

  <main>

    <!-- =================== CARTONS =================== -->
    <section id="tabCartons" class="tabContent active">
      <h2>Contr√¥le des Cartons</h2>
      <form id="formCartons" class="qcForm" data-type="Cartons">
        <label>Date du jour</label>
        <input type="date" name="date_saisie" required />

        <label>Code-barres</label>
        <div class="hstack">
          <input id="cartons_code" name="code_barres" type="text" inputmode="numeric" required />
          <button type="button" class="btn" data-scan="cartons_code">Scanner</button>
        </div>

        <label>Photo principale</label>
        <input type="file" name="photo_principale" accept="image/*" capture="environment" />

        <fieldset>
          <legend>Questions de contr√¥le</legend>

          <div class="qblock">
            <label>Callage papier correct ?</label>
            <select name="callage_papier">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="callage_papier_photos" accept="image/*" capture="environment" multiple />
              <textarea name="callage_papier_commentaire" placeholder="D√©crire le probl√®me"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Intercalaires pr√©sents ?</label>
            <select name="intercalaires_livres">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="intercalaires_livres_photos" accept="image/*" capture="environment" multiple />
              <textarea name="intercalaires_livres_commentaire" placeholder="D√©crire le probl√®me"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Ordre et disposition respect√©s ?</label>
            <select name="ordre_colonnes">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="ordre_colonnes_photos" accept="image/*" capture="environment" multiple />
              <textarea name="ordre_colonnes_commentaire" placeholder="D√©crire le probl√®me"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Scotch bien appliqu√© ?</label>
            <select name="scotch">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="scotch_photos" accept="image/*" capture="environment" multiple />
              <textarea name="scotch_commentaire" placeholder="D√©crire le probl√®me"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Livres d√©poussi√©r√©s ?</label>
            <select name="depoussierage">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="depoussierage_photos" accept="image/*" capture="environment" multiple />
              <textarea name="depoussierage_commentaire" placeholder="D√©crire le probl√®me"></textarea>
            </div>
          </div>
        </fieldset>

        <button type="submit" class="btn primary">üì§ Envoyer</button>
      </form>
    </section>

    <!-- =================== PALETTES AVANT =================== -->
    <section id="tabPalettesAvant" class="tabContent">
      <h2>Contr√¥le des Palettes (Avant camion)</h2>
      <form id="formPA" class="qcForm" data-type="Palettes_Avant">
        <label>Date du jour</label>
        <input type="date" name="date_saisie" required />

        <label>Code-barres palette</label>
        <div class="hstack">
          <input id="pa_code" name="code_barres" type="text" required />
          <button type="button" class="btn" data-scan="pa_code">Scanner</button>
        </div>

        <label>Photo principale</label>
        <input type="file" name="photo_principale" accept="image/*" capture="environment" />

        <fieldset>
          <legend>Questions de contr√¥le</legend>

          <div class="qblock">
            <label>Cartons en bon √©tat ?</label>
            <select name="cartons_etat">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="cartons_etat_photos" accept="image/*" capture="environment" multiple />
              <textarea name="cartons_etat_commentaire"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Intercalaires pr√©sents ?</label>
            <select name="intercalaires_cartons">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="intercalaires_cartons_photos" accept="image/*" capture="environment" multiple />
              <textarea name="intercalaires_cartons_commentaire"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Ordre des cartons respect√© ?</label>
            <select name="ordre_cartons">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="ordre_cartons_photos" accept="image/*" capture="environment" multiple />
              <textarea name="ordre_cartons_commentaire"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Cerclage bien appliqu√© ?</label>
            <select name="cerclage">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="cerclage_photos" accept="image/*" capture="environment" multiple />
              <textarea name="cerclage_commentaire"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Palette stable ?</label>
            <select name="stabilite">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="stabilite_photos" accept="image/*" capture="environment" multiple />
              <textarea name="stabilite_commentaire"></textarea>
            </div>
          </div>
        </fieldset>

        <button type="submit" class="btn primary">üì§ Envoyer</button>
      </form>
    </section>

    <!-- =================== PALETTES DESTINATION =================== -->
    <section id="tabPalettesDestination" class="tabContent">
      <h2>Contr√¥le des Palettes (Destination)</h2>
      <form id="formPD" class="qcForm" data-type="Palettes_Destination">
        <label>Date du jour</label>
        <input type="date" name="date_saisie" required />

        <label>Code-barres palette</label>
        <div class="hstack">
          <input id="pd_code" name="code_barres" type="text" required />
          <button type="button" class="btn" data-scan="pd_code">Scanner</button>
        </div>

        <label>Photo principale</label>
        <input type="file" name="photo_principale" accept="image/*" capture="environment" />

        <fieldset>
          <legend>Questions de contr√¥le</legend>

          <div class="qblock">
            <label>Cartons en bon √©tat ?</label>
            <select name="cartons_etat">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="cartons_etat_photos" accept="image/*" capture="environment" multiple />
              <textarea name="cartons_etat_commentaire"></textarea>
            </div>
          </div>

          <div class="qblock">
            <label>Cerclage bien appliqu√© ?</label>
            <select name="cerclage">
              <option value="OK" selected>OK</option>
              <option value="KO">Pas OK</option>
            </select>
            <div class="koDetails hidden">
              <input type="file" name="cerclage_photos" accept="image/*" capture="environment" multiple />
              <textarea name="cerclage_commentaire"></textarea>
            </div>
          </div>
        </fieldset>

        <button type="submit" class="btn primary">üì§ Envoyer</button>
      </form>
    </section>

    <!-- =================== KPI =================== -->
    <section id="tabKpi" class="tabContent">
      <h2>Tableau de bord KPI</h2>
      <div id="kpiResults">Chargement...</div>
    </section>

  </main>

  <!-- =================== MODAL SCANNER =================== -->
  <div id="scannerModal" class="scanner-modal" style="display:none">
    <div class="scanner-box">
      <h3>Scanner le code-barres</h3>
      <video id="scannerVideo" playsinline autoplay muted style="width:100%;height:auto;background:#000;border-radius:10px"></video>
      <div class="scanner-actions">
        <button id="scannerStart" class="btn primary">D√©marrer</button>
        <button id="scannerStop" class="btn">Arr√™ter</button>
        <button id="scannerClose" class="btn">Fermer</button>
      </div>
      <p class="hint">Visez le code-barres, √©clairez la zone, distance 15‚Äì25 cm.</p>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
