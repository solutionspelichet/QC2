<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pelichet ‚Äî Contr√¥le Qualit√©</title>

  <meta name="theme-color" content="#ff6a00" />

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icon-32.png" sizes="32x32" />
  <link rel="apple-touch-icon" href="icon-180.png" />

  <link rel="stylesheet" href="style.css" />

  <!-- Librairies (optionnel si app.js autoload ; recommand√© pour √©viter les erreurs de chargement) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/quagga@1.2.6/dist/quagga.min.js" defer></script>
</head>

<body>
  <header class="appbar">
    <img class="logo" src="icon-180.png" alt="Pelichet" />
    <h1>Pelichet ‚Äî Contr√¥le Qualit√©</h1>
    <div class="spacer"></div>
    <button id="themeToggle" class="icon-btn" title="Clair / Sombre">üåì</button>
  </header>

  <nav class="tabs">
    <button class="tab active" data-target="tabCartons">Cartons</button>
    <button class="tab" data-target="tabPA">Palettes Avant</button>
    <button class="tab" data-target="tabPD">Palettes Destination</button>
    <button class="tab" data-target="tabKPI">KPI</button>
  </nav>

  <main class="wrap grid">
    <!-- ============ CARTONS ============ -->
    <section id="tabCartons" class="tabContent active">
      <div class="card grid">
        <h2>Contr√¥le des Cartons</h2>
        <form id="formCartons" class="qcForm grid" data-type="Cartons">
          <label>Date
            <input type="date" name="date_saisie" required />
          </label>

          <div class="decode-box grid">
            <label>Code-barres carton</label>
            <div class="decode-actions">
              <label class="btn primary">üì∑ Prendre photo
                <input type="file" class="barcode-photo" data-target="cartons_code" accept="image/*" capture="environment" hidden>
              </label>
              <label class="btn gray">üñºÔ∏è Galerie
                <input type="file" class="barcode-photo" data-target="cartons_code" accept="image/*" hidden>
              </label>
              <button type="button" class="btn" data-scan="cartons_code">üéØ D√©coder (cam√©ra)</button>
            </div>
            <input id="cartons_code" name="code_barres" placeholder="Code-barres" />
          </div>

          <label>Photo principale
            <input type="file" name="photo_principale" accept="image/*" capture="environment" />
          </label>

          <div class="controls-card grid">
            <h3>Contr√¥les</h3>

            <!-- 4.1 Callage papier -->
            <div class="control-item">
              <p class="question">Le callage papier est-il correct ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="callage_papier" value="OK" checked> OK</label>
                <label><input type="radio" name="callage_papier" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="callage_papier_photos" accept="image/*" multiple />
                <textarea name="callage_papier_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.2 Intercalaires colonnes -->
            <div class="control-item">
              <p class="question">Y a-t-il des intercalaires pour s√©parer les colonnes de livres ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="intercalaires_colonnes" value="OK" checked> OK</label>
                <label><input type="radio" name="intercalaires_colonnes" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="intercalaires_colonnes_photos" accept="image/*" multiple />
                <textarea name="intercalaires_colonnes_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.3 Ordre/disposition colonnes -->
            <div class="control-item">
              <p class="question">L‚Äôordre des colonnes et la disposition sont-ils respect√©s ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="ordre_colonnes" value="OK" checked> OK</label>
                <label><input type="radio" name="ordre_colonnes" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="ordre_colonnes_photos" accept="image/*" multiple />
                <textarea name="ordre_colonnes_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.4 Scotch -->
            <div class="control-item">
              <p class="question">Le scotch est-il bien appliqu√© ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="scotch" value="OK" checked> OK</label>
                <label><input type="radio" name="scotch" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="scotch_photos" accept="image/*" multiple />
                <textarea name="scotch_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.5 D√©poussi√©rage -->
            <div class="control-item">
              <p class="question">Les livres ont-ils bien √©t√© d√©poussi√©r√©s ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="depoussierage" value="OK" checked> OK</label>
                <label><input type="radio" name="depoussierage" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="depoussierage_photos" accept="image/*" multiple />
                <textarea name="depoussierage_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>
          </div>

          <button type="submit" class="btn primary">üì§ Envoyer</button>
        </form>
      </div>
    </section>

    <!-- ============ PALETTES AVANT ============ -->
    <section id="tabPA" class="tabContent">
      <div class="card grid">
        <h2>Palettes Avant camion</h2>
        <form id="formPA" class="qcForm grid" data-type="Palettes_Avant">
          <label>Date
            <input type="date" name="date_saisie" required />
          </label>

          <div class="decode-box grid">
            <label>Code-barres palette</label>
            <div class="decode-actions">
              <label class="btn primary">üì∑ Prendre photo
                <input type="file" class="barcode-photo" data-target="pa_code" accept="image/*" capture="environment" hidden>
              </label>
              <label class="btn gray">üñºÔ∏è Galerie
                <input type="file" class="barcode-photo" data-target="pa_code" accept="image/*" hidden>
              </label>
              <button type="button" class="btn" data-scan="pa_code">üéØ D√©coder (cam√©ra)</button>
            </div>
            <input id="pa_code" name="code_barres" placeholder="Code-barres" />
          </div>

          <label>Photo principale
            <input type="file" name="photo_principale" accept="image/*" capture="environment" />
          </label>

          <div class="controls-card grid">
            <h3>Contr√¥les</h3>

            <!-- 4.1 Cartons en bon √©tat -->
            <div class="control-item">
              <p class="question">Les cartons sont-ils en bon √©tat ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="cartons_bon_etat" value="OK" checked> OK</label>
                <label><input type="radio" name="cartons_bon_etat" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="cartons_bon_etat_photos" accept="image/*" multiple />
                <textarea name="cartons_bon_etat_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.2 Intercalaires cartons -->
            <div class="control-item">
              <p class="question">Y a-t-il des intercalaires pour s√©parer les cartons ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="intercalaires_cartons" value="OK" checked> OK</label>
                <label><input type="radio" name="intercalaires_cartons" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="intercalaires_cartons_photos" accept="image/*" multiple />
                <textarea name="intercalaires_cartons_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.3 Ordre/disposition cartons -->
            <div class="control-item">
              <p class="question">L‚Äôordre des cartons et la disposition sont-ils respect√©s ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="ordre_cartons" value="OK" checked> OK</label>
                <label><input type="radio" name="ordre_cartons" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="ordre_cartons_photos" accept="image/*" multiple />
                <textarea name="ordre_cartons_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.4 Cerclage -->
            <div class="control-item">
              <p class="question">Le cerclage est-il bien appliqu√© ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="cerclage" value="OK" checked> OK</label>
                <label><input type="radio" name="cerclage" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="cerclage_photos" accept="image/*" multiple />
                <textarea name="cerclage_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.5 Stabilit√© -->
            <div class="control-item">
              <p class="question">La palette est-elle stable ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="palette_stable" value="OK" checked> OK</label>
                <label><input type="radio" name="palette_stable" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="palette_stable_photos" accept="image/*" multiple />
                <textarea name="palette_stable_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>
          </div>

          <button type="submit" class="btn primary">üì§ Envoyer</button>
        </form>
      </div>
    </section>

    <!-- ============ PALETTES DESTINATION ============ -->
    <section id="tabPD" class="tabContent">
      <div class="card grid">
        <h2>Palettes Destination</h2>
        <form id="formPD" class="qcForm grid" data-type="Palettes_Destination">
          <label>Date
            <input type="date" name="date_saisie" required />
          </label>

          <div class="decode-box grid">
            <label>Code-barres palette</label>
            <div class="decode-actions">
              <label class="btn primary">üì∑ Prendre photo
                <input type="file" class="barcode-photo" data-target="pd_code" accept="image/*" capture="environment" hidden>
              </label>
              <label class="btn gray">üñºÔ∏è Galerie
                <input type="file" class="barcode-photo" data-target="pd_code" accept="image/*" hidden>
              </label>
              <button type="button" class="btn" data-scan="pd_code">üéØ D√©coder (cam√©ra)</button>
            </div>
            <input id="pd_code" name="code_barres" placeholder="Code-barres" />
          </div>

          <label>Photo principale
            <input type="file" name="photo_principale" accept="image/*" capture="environment" />
          </label>

          <div class="controls-card grid">
            <h3>Contr√¥les</h3>

            <!-- 4.1 Cartons en bon √©tat -->
            <div class="control-item">
              <p class="question">Les cartons sont-ils en bon √©tat ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="cartons_bon_etat_dest" value="OK" checked> OK</label>
                <label><input type="radio" name="cartons_bon_etat_dest" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="cartons_bon_etat_dest_photos" accept="image/*" multiple />
                <textarea name="cartons_bon_etat_dest_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>

            <!-- 4.2 Cerclage -->
            <div class="control-item">
              <p class="question">Le cerclage est-il bien appliqu√© ?</p>
              <div class="radio-pills">
                <label><input type="radio" name="cerclage_dest" value="OK" checked> OK</label>
                <label><input type="radio" name="cerclage_dest" value="KO"> KO</label>
              </div>
              <div class="koDetails hidden grid">
                <input type="file" name="cerclage_dest_photos" accept="image/*" multiple />
                <textarea name="cerclage_dest_commentaire" placeholder="D√©crire le probl√®me"></textarea>
              </div>
            </div>
          </div>

          <button type="submit" class="btn primary">üì§ Envoyer</button>
        </form>
      </div>
    </section>

    <!-- ============ KPI ============ -->
    <section id="tabKPI" class="tabContent">
      <div class="card grid">
        <h2>Tableau de bord KPI</h2>
        <div class="hstack">
          <button id="btnKpiRefresh" class="btn">üîÑ Rafra√Æchir</button>
          <span class="spacer"></span>
          <button id="btnExportCsv" class="btn gray">‚¨áÔ∏è Export CSV</button>
          <button id="btnExportXlsx" class="btn primary">‚¨áÔ∏è Export XLSX</button>
        </div>
        <div id="kpiResults" class="kpi">‚Äî</div>
      </div>
    </section>
  </main>

  <!-- Modal Scanner -->
  <div id="scannerModal" class="scanner-modal" style="display:none">
    <div class="scanner-box">
      <h3>Scanner le code-barres</h3>
      <video id="scannerVideo" playsinline autoplay muted></video>
      <div class="scanner-actions">
        <button id="scannerStart" class="btn primary" type="button">D√©marrer</button>
        <button id="scannerStop" class="btn" type="button">Arr√™ter</button>
        <button id="scannerClose" class="btn" type="button">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Loader global -->
  <div id="globalLoader" style="display:none">
    <div class="box">
      <div class="spin"></div>
      <div id="loaderMsg">Chargement‚Ä¶</div>
      <div class="progress-wrap">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- App -->
  <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>

  <script src="app.js"></script>
</body>
</html>
